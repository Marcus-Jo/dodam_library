<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 모든 SQL문을 mapper태그 안에 작성 -->
<mapper namespace="boardMapper">

	<!-- 공지사항 -->
	<resultMap type="com.potato.project.content.vo.NoticeVO" id="notice">
		<id column="NOTICE_CODE" 	 property="noticeCode"/>
		<result column="TITLE" 		 property="title"/>
		<result column="WRITER" 	 property="writer"/>
		<result column="CONTENT" 	 property="content"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="READ_CNT"    property="readCnt"/>
	</resultMap>

	<!-- 공지사항 파일 첨부 -->
	<resultMap type="com.potato.project.common.vo.AttachFileVO" id="noticeFile">
		<id 	column="FILE_CODE" 			property="fileCode"/>
		<result column="ORIGIN_FILE_NAME" 	property="originFileName"/>
		<result column="ATTACHED_FILE_NAME" property="attachedFileName"/>
		<result column="NOTICE_CODE" 		property="noticeCode"/>
 	</resultMap>
 	
	<!-- 문의상담 -->
	<resultMap type="com.potato.project.content.vo.QnaVO" id="qna">
		<id column="QNA_CODE" 		 property="qnaCode"/>
		<result column="TITLE" 		 property="title"/>
		<result column="WRITER" 	 property="writer"/>
		<result column="CONTENT" 	 property="content"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="QNA_PW" 	 property="qnaPw"/>
	</resultMap>
	
	<!-- 문의 답변 -->
	<resultMap type="com.potato.project.content.vo.QnaAnswerVO" id="qnaAnswer">
		<id column="ANSWER_CODE" 	 property="answerCode"/>
		<result column="CONTENT" 	 property="content"/>
		<result column="WRITER" 	 property="writer"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="QNA_CODE" 	 property="qnaCode"/>
	</resultMap>
	
	<!-- 공지사항 리스트 조회 -->
	<select id="selectNoticeList" resultMap="notice">
		SELECT NOTICE_CODE
		     , TITLE
		     , WRITER
		     , TO_CHAR(CREATE_DATE,'YYYY-MM-DD') AS CREATE_DATE
		     , READ_CNT
		FROM NOTICE
	</select>
	
	<!-- 공지사항 INSERT -->
	<insert id="insertNotice">
		INSERT INTO NOTICE(
			   NOTICE_CODE
			 , TITLE
			 , WRITER
			 , CONTENT
			 , CREATE_DATE
		)VALUES(
			   (SELECT 'NOTICE_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(NOTICE_CODE, 8, 3))), 0) + 1, 3, '0') FROM NOTICE)	
			 , #{title}
			 , #{writer}
			 , #{content}
			 , #{createDate}
		)
	</insert>
	
	<!-- 공지사항 파일 첨부를 위한 공지사항 코드 생성  -->
	<select id="selectNoticeCode" resultType="String">
		SELECT 'NOTICE_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(NOTICE_CODE, 8, 3))), 0) + 1, 3, '0') 
		FROM NOTICE
	</select>
	
	<!-- 공지사항 파일 첨부를 위한 파일 코드 넘버 조회 -->
	<select id="nextFileCodeNum" resultType="int">
		SELECT NVL(MAX(TO_NUMBER(SUBSTR(FILE_CODE, 6, 3))) + 1, 1) 
		FROM ATTACH_FILE
	</select>
	
	<!-- 공지사항 파일 첨부 insert -->
	<insert id="insertNoticeFile">
		INSERT INTO ATTACH_FILE(
		    FILE_CODE
		    ,ORIGIN_FILE_NAME
		    ,ATTACHED_FILE_NAME
		    ,NOTICE_CODE
		) VALUES (
		    #{attachFileVO.fileCode}
		    ,#{attachFileVO.originFileName}
		    ,#{attachFileVO.attachedFileName}
		    ,#{attachFileVO.noticeCode}
		)
	</insert>
	
	<!--............................... 상담문의 부분 .....................................-->
	
	<!-- 문의상담 리스트 조회 -->
	<select id="selectQnaList" resultMap="qna">
		SELECT QNA_CODE
		     , TITLE
		     , WRITER
		     , TO_CHAR(CREATE_DATE,'YYYY-MM-DD') AS CREATE_DATE
		     , QNA_PW
		FROM QNA
	</select>
	
	<!-- 문의상담 INSERT -->
	<insert id="insertQna">
		INSERT INTO QNA(
	            QNA_CODE
	          , TITLE
	          , WRITER
	          , CONTENT
	          , CREATE_DATE
	          , QNA_PW
		)VALUES(
				(SELECT 'QNA_'||LPAD(NVL(MAX(TO_NUMBER(SUBSTR(QNA_CODE, 5, 3))), 0) + 1, 3, '0') FROM QNA)
				,#{title}
				,#{writer}
				,#{content}
				,#{createDate}
				,#{qnaPw}
	)
	</insert>
	
	<!-- 상담문의 상세보기 -->
	<select id="selectQna" resultMap="qna">
		SELECT QNA_CODE
		     , TITLE
		     , WRITER
		     , CONTENT
		     , TO_CHAR(CREATE_DATE,'YYYY-MM-DD') AS CREATE_DATE
		FROM QNA
		WHERE QNA_CODE = #{qnaCode}
	</select>
</mapper>